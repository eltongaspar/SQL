-- Verificador CTEx NF Entrada x NF Saida x Financeiro x TES x Fornecedor x Transportadora x Ordem de Carga 
 -- NF Entrada Cab
Select Distinct  
ISNULL(CONVERT(VARCHAR(8000), CONVERT(VARBINARY(8000), GXG_OBS)),'') AS [OBS],
ISNULL(CONVERT(VARCHAR(8000), CONVERT(VARBINARY(8000), GXG_EDIMSG)),'') AS [MGS],
ISNULL(CONVERT(VARCHAR(8000), CONVERT(VARBINARY(8000), GXG_ZZMSG)),'') AS [ZZMGS],
GXG_EDISIT, GXG_DTIMP,GXG_CTE,

	Case 
	When GXG_EDISIT = '1'  Then 'Importado'
	When GXG_EDISIT = '2'  Then 'Importado com Erro'
	When GXG_EDISIT = '3'  Then 'Rejeitado'
	When GXG_EDISIT = '4'  Then 'Processado'
	When GXG_EDISIT = '5'  Then 'Erro Impeditivo'
	Else 'ANALISAR'
	End AS Status_EDI,

F1_FILIAL,F1_ESPECIE,F1_DOC,F1_DUPL,E2_NUM,F2_DOC,ZZ9_DOC,
E2_VALOR,F1_VALBRUT,F1_VALMERC, F1_VALPEDG,GXG_PEDAG,(F1_VALBRUT-F1_VALMERC) As DIF,
D1_TES,F4_TEXTO, F4_AGRPEDG,
(F1_VALPEDG-GXG_PEDAG) As DIF_PEDG,
F1_VALICM,F1_VALIMP5,F1_VALIMP6,D1_COD,
F1_FORNECE,F2_TRANSP,ZZ9_TRANSP,A2_CGC,A2_NOME,A4_CGC,A4_NOME,E2_FORNECE,E2_NOMFOR,
GXG_CTE,GXH_NRIMP,GXG.GXG_NRIMP,F2_CHVNFE,GXH_DANFE,
ISNULL(CONVERT(VARCHAR(8000), CONVERT(VARBINARY(8000), ZZ9_JSCTE)),'') AS [CTE],
	
	Case 
	When F1_VALMERC <> E2_VALOR Then 'CALC C/ PEDAGIO'
	When F1_VALMERC = E2_VALOR Then 'CALC S/ PEDAGIO'
	Else 'ANALISAR'
	End AS Status_ 

From SF1010 SF1 With(NoLock)

	-- Contas a pagar
	Left Join SE2010 SE2 With(NoLock)
	On E2_FILIAL = F1_FILIAL
	And E2_LOJA = F1_LOJA
	And E2_NUM = F1_DOC
	And E2_FORNECE = F1_FORNECE
	--And SE2.D_E_L_E_T_ = ''

	--NF Entrada Itens 
	Left Join SD1010 SD1 With(NoLock)
	On D1_FILIAL = F1_FILIAL
	And D1_LOJA = F1_LOJA
	And D1_DOC = F1_DOC
	And D1_FORNECE = F1_FORNECE
	And D1_LOJA = F1_LOJA
	--And SD1.D_E_L_E_T_ = ''
	
	-- GXG - EDI - Documento de Frete
	Left Join GXG010 GXG With(NoLock)
	On GXG.GXG_FILIAL = F1_FILIAL
	And GXG.GXG_CTE = F1_CHVNFE
	--And GXG.D_E_L_E_T_ = ''

	--GXH - EDI - DOC CARGA DO DOC FRETE
	Left Join GXH010 GXH With(NoLock)
	On GXH.GXH_FILIAL = GXG.GXG_FILIAL
	And GXH.GXH_NRIMP = GXG.GXG_NRIMP
	And GXH.D_E_L_E_T_ = ''
	--And GXH.GXH_SEQ = '00001'

	-- NF Saida - Cab.
	Left Join SF2010 SF2 With(NoLock)
	On SF2.F2_FILIAL = GXH.GXH_FILIAL
	And SF2.F2_CHVNFE = GXH.GXH_DANFE
--	And SF2.F2_TRANSP = GXG.GXG_EMISDF
	--And SF2.D_E_L_E_T_ = ''

	-- NF Saida - Itens 
	Left Join SD2010 SD2 With(NoLock)
	On SD2.D2_FILIAL = SF2.F2_FILIAL
	And SD2.D2_DOC = SF2.F2_DOC
--	And SF2.F2_TRANSP = GXG.GXG_EMISDF
	--And SD2.D_E_L_E_T_ = ''

		
	-- Ordem de Carga 
	Left Join ZZ9010 ZZ9 With(NoLock)
	On ZZ9_FILIAL = F2_FILIAL
	And ZZ9_DOC = F2_DOC
	And ZZ9_TRANSP = F2_TRANSP
	--And ZZ9.D_E_L_E_T_ =''

	-- Transpotadora
	Left Join SA4010 SA4 With(NoLock)
	On SA4.A4_COD = F2_TRANSP
	And SA4.D_E_L_E_T_ = ''

		-- Fornecedor
	Left Join SA2010 SA2 With(NoLock)
	On SA2.A2_COD = F1_FORNECE
	And SA2.A2_LOJA = F1_LOJA
	And SA2.D_E_L_E_T_ = ''


	-- TES
	Left Join SF4010 SF4 With(NoLock)
	On F4_CODIGO = D1_TES
	And SF4.D_E_L_E_T_ =''
	
Where F1_FILIAL In ('01','02','03') and F1_CHVNFE In ('35240628663998000123570000022052061032797187') 
or GXG.GXG_CTE In ('35240628663998000123570000022052061032797187')
And SF1.F1_EMISSAO Between '20240101' and '20241231'
--And (F1_VALPEDG-GXG_PEDAG) > 0
--And SF1.F1_VALMERC <> SE2.E2_VALOR 
--And SE2.E2_BAIXA = '' and SE2.E2_SALDO > 0
--AND GXG.GXG_NRIMP IN ('4A095576264D4E11') 
--And SF1.D_E_L_E_T_ =''
Order By  25,3



--GU3 - EMITENTES DE TRANSPORTE
Select * From GU3010
Where GU3_DTIMPL = '20230531' and D_E_L_E_T_ =''

--GXG - EDI - Documento de Frete
Select GXG_CTE,GXG_CDDEST,GXG_PEDAG,* From GXG010
Where GXG_FILIAL In ('01','02','03') and GXG_DTENT >= '20231201' and D_E_L_E_T_ = ''
and GXG_CDDEST = ''


--GXG - EDI - Documento de Frete
Select GXG_ZZIDTO TOMADOR,GXG_CDREM REMETENTE,GXG_CDDEST DESTINO, GXG_CTE, 

Case 
	When GXG_EDISIT = '1'  Then 'Importado'
	When GXG_EDISIT = '2'  Then 'Importado com Erro'
	When GXG_EDISIT = '3'  Then 'Rejeitado'
	When GXG_EDISIT = '4'  Then 'Processado'
	When GXG_EDISIT = '5'  Then 'Erro Impeditivo'
	Else 'ANALISAR'
	End AS Status_EDI,

* From GXG010
Where GXG_CTE In ('35240628663998000123570000022052061032797187') and D_E_L_E_T_ = ''

-- Validador --GXH - EDI - DOC CARGA DO DOC FRETE - CTEs com mesma Chave
Select GXG_CTE,Count(GXG_CTE) As QTDE_CTE  From GXG010
Where  D_E_L_E_T_ = '' and GXG_DTEMIS >= '20240101' 
Group By GXG_CTE
Order By 2 Desc

-- Validador - --GXH - EDI - DOC CARGA DO DOC FRETE - CTEs Filial em Branco
SELECT GXG_DTEMIS, GXG.*
--UPDATE GXG010 SET D_E_L_E_T_ = '*', R_E_C_D_E_L_ = GXG.R_E_C_N_O_
FROM GXG010 GXG
WHERE GXG_FILIAL BETWEEN '01' AND '03'
--AND GXG_DTEMIS BETWEEN '20230501' AND '20230531'
--AND GXG_DTEMIS >= '20230501'
AND GXG.GXG_CDDEST = ''
--AND GXG_CTE = '35230533674308000171570010000222571000222579'
--AND GXG.R_E_C_N_O_ = 145084
AND GXG.D_E_L_E_T_ = '' and GXG_DTEMIS >= '20240601' 
--GXG_CDDEST	Cod Dest	Codigo do Destinatario

-- Fornecedores Tranportadoras não cadastradas 
SELECT *
FROM GXG010 GXG
LEFT JOIN SA2010 SA2 ON '' =A2_FILIAL
					AND  GXG_EMISDF = SA2.A2_CGC
					AND GXG.D_E_L_E_T_ = SA2.D_E_L_E_T_
WHERE GXG_FILIAL = '01'
AND GXG_EDISIT = '1' --STATUS IMPORTADO
AND SA2.A2_COD IS NULL --NÃO TEM CADASTRO DE FORNECEDOR
AND GXG.D_E_L_E_T_ = ''



--GXH - EDI - DOC CARGA DO DOC FRETE

Select * From GXH010
Where GXH_NRIMP = '5fc0813522474000' and D_E_L_E_T_ = ''



--ORDEM DE CARGA                
Select ISNULL(CONVERT(VARCHAR(8000), CONVERT(VARBINARY(8000), ZZ9_JSCTE)),'') AS [CTE],
ISNULL(CONVERT(VARCHAR(8000), CONVERT(VARBINARY(8000), ZZ9_JSVOLU)),'') AS [VOL],
ISNULL(CONVERT(VARCHAR(8000), CONVERT(VARBINARY(8000), ZZ9_JSINFO)),'') AS [INFO],
* From  ZZ9010 With(Nolock)
Where ZZ9_DOC In ('')
and D_E_L_E_T_ = ''
Order By ZZ9_DOC


 --- GXG - EDI - Documento de Frete
Select ISNULL(CONVERT(VARCHAR(8000), CONVERT(VARBINARY(8000), GXG_OBS)),'') AS [OBS],
ISNULL(CONVERT(VARCHAR(8000), CONVERT(VARBINARY(8000), GXG_EDIMSG)),'') AS [MGS],
ISNULL(CONVERT(VARCHAR(8000), CONVERT(VARBINARY(8000), GXG_ZZMSG)),'') AS [ZZMGS],
* From  GXG010
Where GXG_CTE In ('35231236291207000100570020000029761000750894')
And D_E_L_E_T_ = ''


--Company
Select * From SYS_COMPANY
Where M0_CGC In ('02544042000208','02544042000119') and D_E_L_E_T_ = ''

--NF Entrada Cab.
Select F1_ORIGEM,SF1.D_E_L_E_T_,

	Case 
	When F1_ORIGEM = 'COMXCOL' Then 'AUTO_IMPORT'
	When F1_ORIGEM = 'AtuDocFr' Then 'AUTO_CTE'
	When F1_ORIGEM = 'cbcInTrC' Then 'AUTO_IND'
	Else 'MANUAL'
	End AS Status_ ,
*
From SF1010 SF1

	Inner Join SX5010 SX5
	On X5_FILIAL = F1_FILIAL
	And X5_TABELA = '42' --ESPECIES DE DOCUMENTOS FISCAIS                         
	And X5_CHAVE = F1_ESPECIE
	And SX5.D_E_L_E_T_ = ''

Where F1_CHVNFE = '35240628663998000123570000022052061032797187'
and D_E_L_E_T_ =''

--NF Entrada Itens 
Select * From SD1010
Where D1_FILIAL In('02' ) and D1_DOC In ('000072685') and D_E_L_E_T_ ='' 

-- Livro Fiscal Cab.
Select * From SF3010
Where F3_CHVNFE = '35240628663998000123570000022052061032797187'and D_E_L_E_T_ =''

--Livro Fiscal Itens 
Select * From SFT010
Where FT_FILIAL In('02' ) and FT_NFISCAL In ('000072685') and FT_CLIEFOR = 'VOOYCV'
and D_E_L_E_T_ ='' 



-- Tranportadoras x Transportadoras (Fat x GFE)
Select A4_CGC,* From SA4010
Where A4_COD = '000976'

Select A4_COD,A4_CGC,A4_NOME,* From GU3010 GU3

	Inner Join SA4010 SA4
	On A4_CGC = GU3_CDEMIT
	And SA4.D_E_L_E_T_ = ''

Where GU3.D_E_L_E_T_ = ''

