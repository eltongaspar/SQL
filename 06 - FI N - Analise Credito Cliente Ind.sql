-- Analise de Liberacao de Credito por Cliente com Industrializacao 
-- Erros de Itens com liberaçao parcial, sistema retorna dis resultados para o mesmo item e quebra o código 

---- PV com Industrialização - Completo Item a Item 
Select SC6.C6_NUM,SC6IND.C6_NUM,SUBSTRING(SC6.C6_ZZPVORI,1,6) As NUM_PED,Substring(SC6.C6_ZZPVORI,7,2) As ITEM_PED,
SC6.C6_ZZPVORI,SC6IND.C6_ZZPVORI,SC6.C6_ITEM,SC6IND.C6_ITEM,SC6.C6_ITEMIMP,SC6IND.C6_ITEMIMP,
* From SC6010 SC6 With(NoLock) -- Industrializacao 
					 
	Left Join SC6010 SC6IND With(NoLock)
	On SC6IND.C6_FILIAL = '01'
	And SC6IND.C6_CLI = '008918'
	And SC6IND.C6_LOJA = '01'
	And SC6IND.C6_NUM = SUBSTRING(SC6.C6_ZZPVORI,1,6)
	And (SC6IND.C6_ITEM = Substring(SC6.C6_ZZPVORI,7,2)
	Or SC6IND.C6_ITEMIMP = Substring(SC6.C6_ZZPVORI,7,2))
	And SC6IND.C6_PRODUTO = Substring(SC6.C6_PRODUTO,1,10)
	And SC6IND.D_E_L_E_T_ = ''

Where SC6.C6_FILIAL In ('02') And SC6.C6_NUM = '107473'
And (SC6.C6_LOCAL = '10' OR SC6.C6_SEMANA = 'TAUTOM' ) 
--And SC6.C6_ITEM = '12'
And SC6.D_E_L_E_T_ = ''
Order By 4

-- PV com Industrialização - Group By por Produto e Item 
Select SC6.C6_NUM,Substring(SC6.C6_PRODUTO,1,10) As C6_PRODUTO,SC6.C6_ITEM,
Sum(SC6.C6_QTDVEN) As SC6_C6_QTDVEN, Sum(SC6IND.C6_QTDVEN) As SC6IND_C6_QTDVEN, 
Sum(SC6.C6_QTDENT) As SC6_C6_QTDENT,Sum(SC6IND.C6_QTDENT) As SC6IND_C6_QTDENT,
Sum(SC6.C6_QTDEMP) As SC6_C6_QTDEMP, Sum(SC6IND.C6_QTDEMP) As SC6IND_C6_QTDEMP

From SC6010 SC6 With(NoLock) -- Industrializacao 
					 
	Left Join SC6010 SC6IND With(NoLock)
	On SC6IND.C6_FILIAL = '01'
	And SC6IND.C6_CLI = '008918'
	And SC6IND.C6_LOJA = '01'
	And SC6IND.C6_NUM = SUBSTRING(SC6.C6_ZZPVORI,1,6)
	And (SC6IND.C6_ITEM = Substring(SC6.C6_ZZPVORI,7,2)
	Or SC6IND.C6_ITEMIMP = Substring(SC6.C6_ZZPVORI,7,2))
	And SC6IND.C6_PRODUTO = Substring(SC6.C6_PRODUTO,1,10)
	And SC6IND.D_E_L_E_T_ = ''

Where SC6.C6_FILIAL In ('02') And SC6.C6_NUM = '107473'
--And (SC6.C6_LOCAL = '10' OR SC6.C6_SEMANA = 'TAUTOM' ) 
And SC6.D_E_L_E_T_ = ''
Group By SC6.C6_NUM,Substring(SC6.C6_PRODUTO,1,10),SC6.C6_ITEM
Order By 3

-- PV com industrialização - Group By por Produto -sem Item PV 
Select SC6.C6_NUM,Substring(SC6.C6_PRODUTO,1,10) As C6_PRODUTO,
Sum(SC6.C6_QTDVEN) As C6_QTDVEN, Sum(SC6.C6_QTDENT) As C6_QTDENT, Sum(SC6.C6_QTDEMP) As C6_QTDEMP,
					 
IND_VEN = (Select Sum(SC6IND.C6_QTDVEN) From SC6010 SC6IND With(NoLock)
			Where SC6IND.C6_FILIAL = '01'
			And SC6IND.C6_CLI = '008918'
			And SC6IND.C6_LOJA = '01'
			And SC6IND.C6_NUM = SUBSTRING(SC6.C6_ZZPVORI,1,6)
			And (SC6IND.C6_ITEM = Substring(SC6.C6_ZZPVORI,7,2)
			Or SC6IND.C6_ITEMIMP = Substring(SC6.C6_ZZPVORI,7,2))
			And SC6IND.C6_PRODUTO = Substring(SC6.C6_PRODUTO,1,10)
			And SC6IND.D_E_L_E_T_ = ''),


IND_ENT = (Select Sum(SC6IND.C6_QTDENT) From SC6010 SC6IND With(NoLock)
			Where SC6IND.C6_FILIAL = '01'
			And SC6IND.C6_CLI = '008918'
			And SC6IND.C6_LOJA = '01'
			And SC6IND.C6_NUM = SUBSTRING(SC6.C6_ZZPVORI,1,6)
			And (SC6IND.C6_ITEM = Substring(SC6.C6_ZZPVORI,7,2)
			Or SC6IND.C6_ITEMIMP = Substring(SC6.C6_ZZPVORI,7,2))
			And SC6IND.C6_PRODUTO = Substring(SC6.C6_PRODUTO,1,10)
			And SC6IND.D_E_L_E_T_ = ''),

IND_EMP = (Select Sum(SC6IND.C6_QTDEMP) From SC6010 SC6IND With(NoLock)
			Where SC6IND.C6_FILIAL = '01'
			And SC6IND.C6_CLI = '008918'
			And SC6IND.C6_LOJA = '01'
			And SC6IND.C6_NUM = SUBSTRING(SC6.C6_ZZPVORI,1,6)
			And (SC6IND.C6_ITEM = Substring(SC6.C6_ZZPVORI,7,2)
			Or SC6IND.C6_ITEMIMP = Substring(SC6.C6_ZZPVORI,7,2))
			And SC6IND.C6_PRODUTO = Substring(SC6.C6_PRODUTO,1,10)
			And SC6IND.D_E_L_E_T_ = '')


From SC6010 SC6 With(NoLock) -- Industrializacao 
Where SC6.C6_FILIAL In ('02') And SC6.C6_NUM = '107473'
--And (SC6.C6_LOCAL = '10' OR SC6.C6_SEMANA = 'TAUTOM' ) 
And SC6.D_E_L_E_T_ = ''
Group By SC6.C6_NUM,Substring(SC6.C6_PRODUTO,1,10),
SC6.C6_ZZPVORI


---- PV com Industrialização - Completo Item a Item - Count validacao 
-- Indicados 
Select SC6.C6_NUM,Substring(SC6.C6_PRODUTO,1,10) AS C6_PRODUTO,SC6.C6_ITEM, 
SC6IND.C6_NUM,SC6IND.C6_PRODUTO,Substring(SC6.C6_ZZPVORI,7,2) As C6IND_ITEM,
Count(SC6.C6_NUM) As C6_NUM_QTDE,Count(Substring(SC6.C6_PRODUTO,1,10)) As C6_PRODUTO_QTDE, Count(SC6.C6_ITEM) As C6_ITEM_QTDE,
Count(SC6IND.C6_NUM) As C6IND_NUM_QTDE,Count(SC6IND.C6_PRODUTO) As C6IND_PRODUTO_QTDE, Count(Substring(SC6.C6_ZZPVORI,7,2)) As C6IND_ITEM_QTDE,
Count(SC6IND.C6_ITEMIMP) C6IND_ITEMIMP_QTDE
--Count(SC6IND.C6_PRODUTO)
--Count(SC6IND.C6_NUM),
--SUBSTRING(SC6.C6_ZZPVORI,1,6) As NUM_PED,Substring(SC6.C6_ZZPVORI,7,2) As ITEM_PED,
--SC6.C6_ZZPVORI,SC6IND.C6_ZZPVORI,SC6.C6_ITEM,SC6IND.C6_ITEM,SC6.C6_ITEMIMP,SC6IND.C6_ITEMIMP
From SC6010 SC6 With(NoLock) -- Industrializacao 
					 
	Left Join SC6010 SC6IND With(NoLock)
	On SC6IND.C6_FILIAL = '01'
	And SC6IND.C6_CLI = '008918'
	And SC6IND.C6_LOJA = '01'
	And SC6IND.C6_NUM = SUBSTRING(SC6.C6_ZZPVORI,1,6)
	And (SC6IND.C6_ITEM = Substring(SC6.C6_ZZPVORI,7,2)
	Or SC6IND.C6_ITEMIMP = Substring(SC6.C6_ZZPVORI,7,2))
	And SC6IND.C6_PRODUTO = Substring(SC6.C6_PRODUTO,1,10)
	And SC6IND.D_E_L_E_T_ = ''

Where SC6.C6_FILIAL In ('02') And SC6.C6_NUM = '107473'
And SC6.C6_ITEMIMP <> ''
And SC6IND.C6_ITEMIMP <> Substring(SC6.C6_ZZPVORI,7,2)
--And (SC6.C6_LOCAL = '10' OR SC6.C6_SEMANA = 'TAUTOM' ) 
--And SC6.C6_ITEM = '12'
And SC6.D_E_L_E_T_ = ''
Group By SC6.C6_NUM,SC6.C6_ITEM,Substring(SC6.C6_PRODUTO,1,10),SC6IND.C6_ITEMIMP,
SC6IND.C6_NUM,SC6IND.C6_PRODUTO,Substring(SC6.C6_ZZPVORI,7,2)
Order By 3