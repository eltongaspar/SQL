--VERIFICAR CUSTO DAS DEVOLUÇÕES (ENTRADAS) DE PODER 'EM TERCEIROS' SE SÃO IGUAIS AO CUSTO DAS REMESSAS (SAÍDAS) QUE ORIGINARAM ESSE PODER 'EM TERCEIROS'

SELECT SB6.B6_PRODUTO AS PRODUTO, SB6.B6_DOC AS DOCSAI,SB6.B6_IDENT AS IDSAI, SB6.B6_QUANT AS QTDESAI, SB6.B6_CUSTO1 AS CUSTSAI, (SB6.B6_CUSTO1 / SB6.B6_QUANT) AS CUST_MEDIO_SAI, SB6.B6_EMISSAO AS DTENT, 
ISB6.B6_IDENT AS IDENT, ISB6.B6_DOC AS DOCENT, ISB6.B6_CUSTO1 AS CUSTENT, ISB6.B6_QUANT AS QTDENT, (ISB6.B6_CUSTO1/ISB6.B6_QUANT) AS CUSTO_MEDIO_ENT, ISB6.B6_EMISSAO AS DTENT
FROM SB6010 SB6
INNER JOIN (
					SELECT SIB6.B6_IDENT, SIB6.B6_DOC, SIB6.B6_QUANT, SIB6.B6_CUSTO1, SIB6.B6_EMISSAO 
					FROM SB6010 SIB6
					WHERE SIB6.B6_FILIAL = '01'
					AND SIB6.B6_EMISSAO >= '20170901' AND SIB6.B6_EMISSAO <= '20170930'
					AND SIB6.B6_TIPO = 'E'
					AND SIB6.B6_ESTOQUE = 'S'
					AND SIB6.B6_TES <= 499
					AND SIB6.D_E_L_E_T_ = ''
			) AS ISB6 ON SB6.B6_IDENT = ISB6.B6_IDENT
WHERE SB6.B6_FILIAL = '01'
AND SB6.B6_IDENT IN (
					SELECT DISTINCT B6.B6_IDENT
					FROM SB6010 B6
					WHERE B6.B6_FILIAL = '01'
					AND B6.B6_EMISSAO >= '20170901' AND B6.B6_EMISSAO <= '20170930'
					AND B6.B6_TIPO = 'E'
					AND B6.B6_ESTOQUE = 'S'
					AND B6.B6_TES <= 499
					AND B6.D_E_L_E_T_ = ''
					)
AND SB6.B6_TES >= 500
AND SB6.D_E_L_E_T_ = ''
AND ROUND((SB6.B6_CUSTO1 / SB6.B6_QUANT),2) <> ROUND((ISB6.B6_CUSTO1/ISB6.B6_QUANT),2) --APENAS OS COM DIFERENÇAS
ORDER BY SB6.B6_PRODUTO




--AINDA EM DESENVOLVIMENTO
--COMPARA B6 COM D1
SELECT SB6.B6_PRODUTO, SB6.B6_IDENT, SB6.B6_DOC, SB6.B6_QUANT, SB6.B6_CUSTO1, SB6.B6_EMISSAO, SD1.D1_CUSTO  
FROM SB6010 SB6
INNER JOIN SD1010 AS SD1 ON SB6.B6_FILIAL = SD1.D1_FILIAL AND SB6.B6_DOC = SD1.D1_DOC AND SB6.B6_IDENT = SD1.D1_IDENTB6 AND SB6.B6_QUANT = SD1.D1_QUANT 
WHERE SB6.B6_FILIAL = '01'
AND SB6.B6_EMISSAO >= '20170901' AND SB6.B6_EMISSAO <= '20170930'
AND SB6.B6_TIPO = 'E'
AND SB6.B6_ESTOQUE = 'S'
AND SB6.B6_TES <= 499
AND SB6.D_E_L_E_T_ = ''


